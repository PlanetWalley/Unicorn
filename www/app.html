<html>
    <head>
        <meta charset="utf-8">
        <meta content="telephone=no" name="format-detection">
        <meta content="no" name="msapplication-tap-highlight">
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta content=
        "user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi"
        name="viewport">
        <!-- <link href="css/index.css" rel="stylesheet" type="text/css"> -->
        <link href=
        "http://code.jquery.com/mobile/1.4.4/jquery.mobile-1.4.4.min.css" rel=
        "stylesheet">
        <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
        <script src=
        "http://code.jquery.com/mobile/1.4.4/jquery.mobile-1.4.4.min.js"></script>
        <script src="https://code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
        
        
        <script src="cordova.js" type="text/javascript"></script> 
        <script src="js/index.js" type="text/javascript"></script> 
        
        <title>Unicorn Project</title>
    </head>
    
    <body>
        Welcome here;
        <p id="user_id"> Hello There</p>
        <p id="longitude">Longitude</p>
        <p id="latitude">Latitude</p>
        <p id="count">0</p>
        
        <input data-clear-btn="true" id="status" name="status" type=
            "text">
        <button id="change_status_btn">Change Status</button>
    </body>
    <script>
        document.addEventListener("deviceready", onDeviceReady, false);
        function onDeviceReady(){
            $(document).ready(function(){
                var count = 0;
                var postit_id = null;
                console.log("App is ready");
                $("#user_id").html(window.localStorage["user_id"]);
                $("#status").val( window.localStorage["status"]);
                var showPosition = function(position){
                    $("#longitude").html("longitude2: " + position.coords.longitude);
                    $("#latitude").html("latitude2: " + position.coords.latitude);
                    $("#count").html(count);
                    count++;
                    navigator.geolocation.clearWatch(postit_id);
                    
                    //setTimeout(function(){
                    //    getLocation()
                    //}, 10000); // get location after 10 s
                }
                var geolocationError = function(error){
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            alert("User denied the request for Geolocation.");
                            break;
                        case error.POSITION_UNAVAILABLE:
                            alert("Location information is unavailable.");
                            break;
                        case error.TIMEOUT:
                            alert("The request to get user location timed out.");
                            break;
                        case error.UNKNOWN_ERROR:
                            alert("An unknown error occurred.");
                            break;
                    }
                }

                var getLocation = function(){
                    if (navigator.geolocation) {
                        postit_id = navigator.geolocation.watchPosition(showPosition,      
                                                                        geolocationError, 
                                                            {
                                                               enableHighAccuracy: true,
                                                               //maximumAge: 5000, //这两个iOS下不管用
                                                               //timeout: 5000
                                                            });
                    } else {
                         alert("Geolocation is not supported.");
                    }            
                }
                setInterval(function(){getLocation()}, 5000); // update every 5 seconds
                
            })             
        }                 
    </script>
    <script src="js/change_status.js"></script>
</html>